{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "env": {
    "CLAUDE_AUTOCOMPACT_PCT_OVERRIDE": "60",
    "ENABLE_TOOL_SEARCH": "auto"
  },
  "attribution": {
    "commit": "none"
  },
  "cleanupPeriodDays": 30,
  "statusLine": {
    "type": "command",
    "command": "phase=$(cat .build/current-phase 2>/dev/null || echo 'no-phase'); pending=$(ls .build/checkpoints/pending/ 2>/dev/null | wc -l | tr -d ' '); echo \"Phase: $phase | Pending: $pending\""
  },
  "sandbox": {
    "enabled": true,
    "autoAllowBashIfSandboxed": true,
    "network": {
      "allowedDomains": ["pypi.org", "github.com", "api.anthropic.com"]
    }
  },
  "permissions": {
    "deny": [
      "Bash(rm -rf /)",
      "Bash(rm -rf ~)",
      "Bash(sudo:*)",
      "Bash(git push --force:*)",
      "Bash(git reset --hard:*)"
    ],
    "ask": [
      "Bash(git push:*)",
      "Bash(rm:*)",
      "Bash(docker:*)",
      "Bash(docker-compose:*)"
    ],
    "allow": [
      "Bash(uv:*)",
      "Bash(ruff:*)",
      "Bash(mypy:*)",
      "Bash(pytest:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git status)",
      "Bash(git diff:*)",
      "Bash(git log:*)",
      "Bash(git worktree:*)",
      "Bash(chmod:*)",
      "Bash(mkdir:*)",
      "Bash(ls:*)",
      "Bash(whoami)",
      "Bash(pwd)",
      "Bash(cat:*)",
      "Bash(tree:*)",
      "Bash(env)",
      "Bash(echo:*)",
      "Bash(find:*)",
      "Bash(grep:*)",
      "Bash(touch:*)",
      "Bash(date:*)",
      "Bash(jq:*)",
      "Bash(wc:*)",
      "Bash(md5:*)"
    ]
  },
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/session-start.sh"
          }
        ]
      },
      {
        "hooks": [
          {
            "type": "command",
            "command": "today=$(date +%Y-%m-%d); if [ ! -f .build/checkpoints/daily/$today.json ]; then echo \"REMINDER: No daily checkpoint for $today. Consider running /init-session.\"; fi"
          }
        ]
      },
      {
        "hooks": [
          {
            "type": "command",
            "command": "w=''; command -v npx >/dev/null 2>&1 || w=\"${w}npx not found. \"; command -v node >/dev/null 2>&1 || w=\"${w}node not found. \"; [ -f \"$CLAUDE_PROJECT_DIR/.claude/mcp.json\" ] || w=\"${w}.claude/mcp.json missing. \"; [ -f \"$CLAUDE_PROJECT_DIR/.env\" ] && grep -q 'UPSTASH_API_KEY=.' \"$CLAUDE_PROJECT_DIR/.env\" || w=\"${w}UPSTASH_API_KEY not set in .env. \"; if [ -n \"$w\" ]; then echo \"MCP Health WARN: $w Run /mcp to verify.\"; else echo \"MCP Health: OK\"; fi"
          }
        ]
      },
      {
        "matcher": "compact",
        "hooks": [
          {
            "type": "command",
            "command": "echo \"=== POST-COMPACT CONTEXT RE-INJECTION ===\"; echo \"Tech Stack: Python 3.11+, uv, Pydantic v2, httpx, structlog, pathlib\"; echo \"Current Phase: $(cat .build/current-phase 2>/dev/null || echo 'unknown')\"; echo \"Active Project: $(cat .build/active-project 2>/dev/null || echo 'none')\"; echo \"Pending Files: $(ls .build/checkpoints/pending/ 2>/dev/null | tr '\\n' ', ')\"; echo \"IMPORTANT: Read .claude/workflow/ files if working on a project. Run /verify before commit.\""
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/pre-write.sh"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/pre-git-commit.sh"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/post-code.sh",
            "timeout": 60
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo \"=== CONTEXT PRESERVATION ===\"; echo \"Current Phase: $(cat .build/current-phase 2>/dev/null || echo 'unknown')\"; echo \"Pending Verifications: $(ls .build/checkpoints/pending/ 2>/dev/null | wc -l | tr -d ' ')\"; echo \"Active Project: $(cat .build/active-project 2>/dev/null || echo 'none')\""
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "pending=$(ls .build/checkpoints/pending/ 2>/dev/null | wc -l | tr -d ' '); if [ \"$pending\" -gt 0 ]; then echo \"WARNING: $pending files pending verification. Run /verify before commit.\"; fi"
          }
        ]
      }
    ],
    "PostToolUseFailure": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "echo '{\"event\":\"tool_failure\",\"tool\":\"'\"$TOOL_NAME\"'\",\"timestamp\":\"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"}' >> .build/logs/agents/$(date +%Y-%m-%d).jsonl 2>/dev/null || true"
          }
        ]
      }
    ],
    "SubagentStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo '{\"event\":\"subagent_start\",\"timestamp\":\"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"}' >> .build/logs/agents/$(date +%Y-%m-%d).jsonl 2>/dev/null || true"
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo '{\"event\":\"subagent_stop\",\"timestamp\":\"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"}' >> .build/logs/agents/$(date +%Y-%m-%d).jsonl 2>/dev/null || true"
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "prompt=\"$USER_PROMPT\"; match=$(echo \"$prompt\" | grep -ioE '(Contin[úu]a con|Continue with|Trabaja en|Work on)\\s+(.+)' | sed -E 's/(Contin[úu]a con|Continue with|Trabaja en|Work on)\\s+//i'); if [ -n \"$match\" ]; then name=$(echo \"$match\" | xargs | tr '[:upper:]' '[:lower:]' | tr ' ' '-'); found=''; for ext in json md yaml; do if [ -f \"$CLAUDE_PROJECT_DIR/projects/$name.$ext\" ]; then found=\"$CLAUDE_PROJECT_DIR/projects/$name.$ext\"; break; fi; done; if [ -n \"$found\" ]; then echo \"PROJECT DETECTED: $match -> $found\"; else echo \"PROJECT DETECTED: $match (no config found in projects/)\"; fi; fi"
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo '{\"event\":\"session_end\",\"timestamp\":\"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'\"}' >> .build/logs/sessions/$(date +%Y-%m-%d).jsonl 2>/dev/null || true; rm -f /tmp/claude/*.tmp 2>/dev/null || true"
          }
        ]
      }
    ]
  }
}
